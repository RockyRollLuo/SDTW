/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.65
 * Generated at: 2017-04-26 08:17:53 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.main;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import com.xietong.software.common.HeadConst;
import com.xietong.software.base.Power;
import com.sun.corba.se.impl.protocol.giopmsgheaders.Message;
import com.xietong.software.common.CEditConst;
import java.util.ArrayList;
import java.sql.*;
import java.io.*;
import java.util.*;
import jxl.*;
import jxl.write.*;
import java.math.BigDecimal;
import com.xietong.software.sdtw.db.*;
import com.xietong.software.common.HtmlTool;
import com.xietong.software.util.Tool;
import com.xietong.software.common.UserInfo;

public final class sitemsg_002dlist_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html;charset=utf-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "jqueryui.jsp", out, false);
      out.write('\r');
      out.write('\n');

  UserInfo userinfo=Tool.getUserInfo(request);
if(userinfo==null){
	return;
}
Map UserCnNameMap=  CEditConst.getUserCnNameMap(userinfo);

      out.write("\r\n");
      out.write("\r\n");
      out.write("<html>\r\n");
      out.write("<head>\r\n");
      out.write("<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\r\n");

if(userinfo.hasFunPower(Power.USERSTUDENTPOWER)){

      out.write("\r\n");
      out.write("<link rel=\"stylesheet\" type=\"text/css\" href=\"");
      out.print(HeadConst.apache_url);
      out.write("/css/common-student.css\">\r\n");
      out.write("<script src=\"js/jquery.min.js\"></script>\r\n");
      out.write("\r\n");
      out.write("<!-- <script src=\"../js/jquery.min.js\"></script> -->\r\n");
      out.write("<script src=\"../js/tablelist.js\"></script>\r\n");
      out.write("<style type=\"text/css\">\r\n");
      out.write("#infoarea\r\n");
      out.write("{\r\n");
      out.write("   margin-top:15px;\r\n");
      out.write("   position:relative;\r\n");
      out.write("   width:100%;\r\n");
      out.write("   border:0pt solid #0008000;\r\n");
      out.write("   padding:0px;\r\n");
      out.write("   overflow:hidden;\r\n");
      out.write("\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write(".info-table\r\n");
      out.write("{\r\n");
      out.write("   background-color:#fff;\r\n");
      out.write("   margin-top:20px;\r\n");
      out.write("   border:1px solid #DCDCDC;\r\n");
      out.write("   width:800px;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write(".info-table a:link,.info-table a:hover,.info-tablel a:visited,.info-table a:active\r\n");
      out.write("{\r\n");
      out.write("    font-size:12px;\r\n");
      out.write("    color:#666;\r\n");
      out.write("    text-decoration:none;\r\n");
      out.write("}\r\n");
      out.write(".areatable a:link,.areatable a:hover,.areatable a:visited,.areatable a:active{\r\n");
      out.write("\tfont-size:12px;\r\n");
      out.write("    color:#666;\r\n");
      out.write("    text-decoration:none;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write(".titlerow\r\n");
      out.write("{\r\n");
      out.write("   border-bottom:1px solid #fff;\r\n");
      out.write("   padding-left:20px;\r\n");
      out.write("   padding-right:20px;\r\n");
      out.write("\r\n");
      out.write("   margin-left:10px;\r\n");
      out.write("   background-color:#DCDCDC;\r\n");
      out.write("\r\n");
      out.write("   font-size:14px;\r\n");
      out.write("   font-family:微软雅黑;\r\n");
      out.write("   color:#666;\r\n");
      out.write("\r\n");
      out.write("   vertical-align:middle;\r\n");
      out.write("   line-height:150%;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write(".bottomrow\r\n");
      out.write("{\r\n");
      out.write("   border-top:1px solid #DCDCDC;\r\n");
      out.write("   padding-left:20px;\r\n");
      out.write("   padding-right:20px;\r\n");
      out.write("\r\n");
      out.write("   background-color:#b3cfe4;\r\n");
      out.write("\r\n");
      out.write("   font-size:15px;\r\n");
      out.write("   color:#333333;\r\n");
      out.write("\r\n");
      out.write("   vertical-align:middle;\r\n");
      out.write("   line-height:150%;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write(".textrow\r\n");
      out.write("{\r\n");
      out.write("   padding-left:0px;\r\n");
      out.write("   padding-right:0px;\r\n");
      out.write("\r\n");
      out.write("   background-color:#b3cfe4;\r\n");
      out.write("\r\n");
      out.write("   font-size:12px;\r\n");
      out.write("   color:#333333;\r\n");
      out.write("\r\n");
      out.write("   vertical-align:middle;\r\n");
      out.write("   line-height:150%;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write(".areatable\r\n");
      out.write("{\r\n");
      out.write("   width:650px;\r\n");
      out.write("   margin-top:15px;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write(".areatitle\r\n");
      out.write("{\r\n");
      out.write("    font-size:14px;\r\n");
      out.write("    font-weight:bold;\r\n");
      out.write("    color:#666;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write(".titlecell\r\n");
      out.write("{\r\n");
      out.write("    font-size:12px;\r\n");
      out.write("    color:#333333;\r\n");
      out.write("    vertical-align:middle;\r\n");
      out.write("}\r\n");
      out.write("</style>\r\n");

}else{ 
      out.write("\r\n");
      out.write("<link rel=\"stylesheet\" type=\"text/css\" href=\"css/common.css\">\r\n");
      out.write("<style type=\"text/css\">\r\n");
      out.write("#infoarea\r\n");
      out.write("{\r\n");
      out.write("   margin-top:15px;\r\n");
      out.write("   position:relative;\r\n");
      out.write("   width:100%;\r\n");
      out.write("   border:0pt solid #0008000;\r\n");
      out.write("   padding:0px;\r\n");
      out.write("   overflow:hidden;\r\n");
      out.write("\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write(".info-table\r\n");
      out.write("{\r\n");
      out.write("   background-color:#fff;\r\n");
      out.write("   margin-top:20px;\r\n");
      out.write("   border:1px solid #3992d0;\r\n");
      out.write("   width:800px;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write(".info-table a:link,.info-table a:hover,.info-tablel a:visited,.info-table a:active\r\n");
      out.write("{\r\n");
      out.write("    font-size:12px;\r\n");
      out.write("    color:#3992d0;\r\n");
      out.write("    text-decoration:none;\r\n");
      out.write("}\r\n");
      out.write(".areatable a:link,.areatable a:hover,.areatable a:visited,.areatable a:active\r\n");
      out.write("{\r\n");
      out.write("\tfont-size:12px;\r\n");
      out.write("    color:#3992d0;\r\n");
      out.write("    text-decoration:none;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write(".titlerow\r\n");
      out.write("{\r\n");
      out.write("   border-bottom:1px solid #fff;\r\n");
      out.write("   padding-left:20px;\r\n");
      out.write("   padding-right:20px;\r\n");
      out.write("\r\n");
      out.write("   margin-left:10px;\r\n");
      out.write("   background-color:#3992d0;\r\n");
      out.write("\r\n");
      out.write("   font-size:14px;\r\n");
      out.write("   font-family:微软雅黑;\r\n");
      out.write("   color:#fff;\r\n");
      out.write("\r\n");
      out.write("   vertical-align:middle;\r\n");
      out.write("   line-height:150%;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write(".bottomrow\r\n");
      out.write("{\r\n");
      out.write("   border-top:1px solid #0163A2;\r\n");
      out.write("   padding-left:20px;\r\n");
      out.write("   padding-right:20px;\r\n");
      out.write("\r\n");
      out.write("   background-color:#b3cfe4;\r\n");
      out.write("\r\n");
      out.write("   font-size:15px;\r\n");
      out.write("   color:#333333;\r\n");
      out.write("\r\n");
      out.write("   vertical-align:middle;\r\n");
      out.write("   line-height:150%;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write(".textrow\r\n");
      out.write("{\r\n");
      out.write("   padding-left:0px;\r\n");
      out.write("   padding-right:0px;\r\n");
      out.write("\r\n");
      out.write("   background-color:#b3cfe4;\r\n");
      out.write("\r\n");
      out.write("   font-size:12px;\r\n");
      out.write("   color:#333333;\r\n");
      out.write("\r\n");
      out.write("   vertical-align:middle;\r\n");
      out.write("   line-height:150%;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write(".areatable\r\n");
      out.write("{\r\n");
      out.write("   width:650px;\r\n");
      out.write("   margin-top:15px;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write(".areatitle\r\n");
      out.write("{\r\n");
      out.write("    font-size:14px;\r\n");
      out.write("    font-weight:bold;\r\n");
      out.write("    color:#0163A2;\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write(".titlecell\r\n");
      out.write("{\r\n");
      out.write("    font-size:12px;\r\n");
      out.write("    color:#333333;\r\n");
      out.write("    vertical-align:middle;\r\n");
      out.write("}\r\n");
      out.write("</style>\r\n");
} 
      out.write("\r\n");
      out.write("\r\n");
      out.write("<script type=\"text/javascript\">\r\n");
      out.write("\r\n");
      out.write("function showwinside(id,title){\r\n");
      out.write("//\talert(\"111111111111\");\r\n");
      out.write("\t");
 if(userinfo.hasFunPower(Power.USERSTUDENTPOWER)){
      out.write("\r\n");
      out.write("\tparent.parent.showDialog('");
      out.print(HeadConst.apache_url);
      out.write("/main/ShortMessagecheck.jsp?id='+id,600,600,title\r\n");
      out.write("\t\t\t,{});\r\n");
      out.write("\t");
}else{
      out.write("\r\n");
      out.write("\tparent.showDialog('");
      out.print(HeadConst.apache_url);
      out.write("/main/ShortMessagecheck.jsp?id='+id,600,600,title\r\n");
      out.write("\t\t\t,{});\r\n");
      out.write("\t");
	}
      out.write("\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\r\n");
      out.write("function showwinside1(id,title){\r\n");
      out.write("\t//alert(\"2222222222222\");\r\n");
      out.write("\t");
 if(userinfo.hasFunPower(Power.USERSTUDENTPOWER)){
      out.write("\r\n");
      out.write("\t\r\n");
      out.write("parent.parent.showDialog(\"");
      out.print(HeadConst.apache_url);
      out.write("/main/bulletin-detail.jsp?id=\"+id,600,600,title\r\n");
      out.write("\t\t\t,{});\r\n");
      out.write("\t");
}else{
      out.write("\r\n");
      out.write("\tparent.showDialog(\"");
      out.print(HeadConst.apache_url);
      out.write("/main/bulletin-detail.jsp?id=\"+id,600,600,title\r\n");
      out.write("\t\t\t,{});\r\n");
      out.write(" ");
	}
      out.write("\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write("</script>\r\n");
      out.write("</head>\r\n");
      out.write("\r\n");
      out.write("<body>\r\n");
      out.write("<div id=\"infoarea\">\r\n");
      out.write("<center> <!-- 删掉center就没有警告了 -->\r\n");
      out.write("\r\n");
      out.write("<table class=\"info-table\" cellpadding=\"0\" cellspacing=\"0\">\r\n");
      out.write("<tr>\r\n");
      out.write("\t<td class=\"titlerow\" height=\"35\">消息列表</td>\r\n");
      out.write("</tr>\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\t<!--系统公告区域-->\r\n");
      out.write("\t<tr>\r\n");
      out.write("    \t<td align=\"center\">\r\n");
      out.write("    \t\t<table class=\"areatable\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\r\n");
      out.write("   \t\t\t\t<tr height=\"10\">\r\n");
      out.write("      \t\t\t\t<td class=\"areatitle\" colspan=\"2\" width=\"10%\" align=\"left\">系统公告</td>\r\n");
      out.write("\t\t\t\t\t<td class=\"areatitle\" width=\"30%\" align=\"center\"></td>\r\n");
      out.write("\t\t\t\t\t<td class=\"areatitle\" align=\"right\">\r\n");
      out.write("\t\t\t\t\t");

if(userinfo.hasFunPower(Power.USERSTUDENTPOWER)){

      out.write("\r\n");
      out.write("\t\t\t\t\t<a href=\"bulletin-more.jsp?page=1\">更多>></a>\r\n");
      out.write("\t\t\t\t\t");
 }else{
      out.write("\r\n");
      out.write("\t\t\t\t\t<a href=\"information/InformationAction.jsp?cmd=list\">更多>></a>\r\n");
      out.write("\t\t\t\t\t");
} 
      out.write("\r\n");
      out.write("\t\t\t\t\t&nbsp;</td>\r\n");
      out.write("\t\t\t\t</tr>\r\n");
      out.write("        \t\t<tr>\r\n");
      out.write("       \t\t\t\t<td class=\"separatorline\" colspan=\"5\"></td>\r\n");
      out.write("\t\t\t\t</tr>\r\n");
      out.write("   \t\t\r\n");
      out.write("\t\t\t\t");

				
			
				 List list2= new ArrayList();
			       List cdt2=new ArrayList();
			       Information ifo= new Information();
			       BaseUserCode user = new BaseUserCode();
			       Map yonghu=CEditConst.getRoleNameMap(userinfo);
			       Map yonghu2=CEditConst.getUserCnNameMap(userinfo);
			       Map xy=CEditConst.getAcademyNameMap(userinfo);
			       Map inclubs=       CEditConst.getClubNameMap(userinfo);
			  	 user=userinfo.getUserCode();
			      String userDept=user.getRoles()+"";
			      System.out.println(userDept+"ddddddddddddd");
			      String slist4="";
			      List list4= new ArrayList();
			      //判断是否是团委用户，不是团委用户只能查看团委和本学院的公告
			      if(userinfo.hasFunPower(Power.USERSTUDENTPOWER)){
			    	  String sno=user.getName();
			    	  ClubMembers cbm=new ClubMembers();
			    	  List list3= new ArrayList();
			    	
				       List cdt3=new ArrayList();
				       cdt3.add("memberSno ='"+sno+"'");
				       list3 =cbm.query( cdt3);
				       
				       //根据学号查学生所参加的社团账号
				       if(list3.size()>0){
				    	   for(int i=0;i<list3.size();i++){
				    		   cbm=(ClubMembers)list3.get(i);
				    		   //根据社团ID再去查询社团账号
				    		  list4.add("'"+cbm.getMemberClubname()+"'");
				    	   }
				    	   //根据社团id查社团账号
					    	  System.out.println(list4);
					    slist4  =Tool.join(",", list4);
					    	System.out.println(slist4); 
					    	Club club= new Club();
					  	  List list5= new ArrayList();
					    	
					       List cdt5=new ArrayList();
					       List shetuanzhanghao= new ArrayList();
					       cdt5.add("id in ("+slist4+")");
					       list5=club.query(cdt5);
					       if(list5.size()>0){
					    	   for(int i=0;i<list5.size();i++){
					    		   club= (Club)list5.get(i);
					    		   shetuanzhanghao.add("'"+club.getClubId()+"'");
					    	   }
					       }
					       //根据社团账号查社团账号在base表中的id
					       String sshetuanzhanghao=Tool.join(",", shetuanzhanghao);
					       List list6= new ArrayList();
					       List shetuanid= new ArrayList();
					       List cdt6=new ArrayList();
					       cdt6.add("name in ("+sshetuanzhanghao+")");
					       BaseUserCode shetuan= new   BaseUserCode ();
					       list6= shetuan.query(cdt6);
					       if(list6.size()>0){
					    	   for(int i=0;i<list6.size();i++){
					    		  shetuan=(BaseUserCode)list6.get(i) ;
					    		  shetuanid.add(shetuan.getId()+"");
					    	   }
					       }
					    	String sshetuanid=Tool.join(",", shetuanid);
					    	 cdt2.add("UserId in ("+sshetuanid+" )or dept in (1,"+user.getDeptId()+")");
					    	  
					      };
				       }else{
				    	   cdt2.add("dept in (1,"+user.getDeptId()+")");
				       }
				   
			      if(userinfo.hasFunPower(Power.STUSER)||userinfo.hasFunPower(Power.UserAdminPower)){
			    	  
			    	  cdt2.add("dept in (1,"+user.getDeptId()+")");
			  
			      }
			     
			       cdt2.add("order by newdate desc ");
			       
			     list2=  ifo.query(cdt2);
			     System.out.println(list2.size()+"1111111111111111111111111111111111");
			     //如果登录用户是社团，过滤掉和自己是同一指导单位的其他社团信息
			    if(userinfo.hasFunPower(Power.STUSER)){
			     if(list2.size()>0){
			    	 for(int i = list2.size()-1;i>=0;i--){
			    		 ifo=(Information)list2.get(i);
			    String fabuyonghudanwei=(String)yonghu.get(ifo.getUserId()+"");
			    String fabuyonghu=(String)yonghu2.get(ifo.getUserId()+"");
			    System.out.println(yonghu.get(ifo.getUserId()+""));
			    System.out.println(yonghu);
			    BaseUserCode gonggaouser= new BaseUserCode();
				 gonggaouser=gonggaouser.getById(ifo.getUserId());
				 if(gonggaouser!=null){
			    System.out.println(gonggaouser.getRoles()+"kaishi");
			    System.out.println(ifo.getUserId());
			    System.out.println(userinfo.getId()+"jieshu");
				if(gonggaouser.getRoles().equals("4")&&ifo.getUserId()!=user.getId()){
					System.out.println("删除");
					list2.remove(i);
					
				}
			    	 }
			     }
			    	 
			     }
			    }
			    //	    //如果用户是学生，过滤掉 指导单位与学生是同一部门，但学生并没有参加的社团公告
			    if(userinfo.hasFunPower(Power.USERSTUDENTPOWER)){
				     if(list2.size()>0){
				    	 for(int i = list2.size()-1;i>=0;i--){
				    		 ifo=(Information)list2.get(i);
				    String fabuyonghudanwei=(String)yonghu.get(ifo.getUserId()+"");
				    String fabuyonghu=(String)yonghu2.get(ifo.getUserId()+"");
				    System.out.println(yonghu.get(ifo.getUserId()+"")+"AAAAAAAAAAAAAAAAAAAAAA");
				    System.out.println(ifo.getUserId()+"BBBBBBBBBBBBBBBBBBBBBB");
				    BaseUserCode gonggaouser= new BaseUserCode();
				 gonggaouser=gonggaouser.getById(ifo.getUserId());
				 if(gonggaouser!=null){
				    System.out.println(gonggaouser.getRoles()+"kaishi");
				    System.out.println(ifo.getUserId());
				    System.out.println(userinfo.getId()+"jieshu");
					if(gonggaouser.getRoles().equals("4")&&!list4.contains("'"+ifo.getUserId()+"'")){
						System.out.println("删除");
						list2.remove(i);
						
					}
				    	 }
				     }
				    	 
				     }
			    
			    }
			    
			    	 System.out.println(list2.size()+"1111111111111111111111111111111111");
			    	 //shuchu
			       	 for(int i=0;i<(list2.size()>=3?3:list2.size());i++){
			    		 ifo=(Information)list2.get(i);
			    String fabuyonghudanwei=(String)yonghu.get(ifo.getUserId()+"");
			    String fabuyonghu=(String)yonghu2.get(ifo.getUserId()+"");
			    //System.out.println(yonghu.get(ifo.getUserId()+""));
				
      out.write("\r\n");
      out.write("\t\t\t\t <tr height=\"25\">\r\n");
      out.write("        \t\t\t<td class=\"titlecell\" width=\"5%\">&nbsp;&nbsp;[");
      out.print(i+1);
      out.write("]</td>\r\n");
      out.write("        \t\t\t\r\n");
      out.write("        \t\t\t<td   width=\"30%\"  style=\"text-align:left\"  class=\"titlecell\"  >\r\n");
      out.write("              \t\t\t<a title=\"");
      out.print(ifo.getSubject() );
      out.write("\" href=\"#\" onclick=\"showwinside1(");
      out.print(ifo.getId());
      out.write(',');
      out.write('\'');
      out.print(ifo.getSubject());
      out.write("')\" >&nbsp;");
      out.print(ifo.getSubject().length()>15?ifo.getSubject().substring(0, 15)+"..":ifo.getSubject() );
      out.write("</a>\r\n");
      out.write("        \t\t\t</td>\r\n");
      out.write("        \t\t\t\r\n");
      out.write("        \t\t\t<td  width=\"30%\"class=\"titlecell\" align=\"center\">");
      out.print(fabuyonghu );
      out.write("</td>\r\n");
      out.write("        \t\t\t<td  width=\"20%\"  class=\"titlecell\" align=\"right\" style=\"padding-right:7px;\">");
      out.print(Tool.stringOfCnDate(ifo.getNewDate()));
      out.write("</td>\r\n");
      out.write("        \t\t\t\r\n");
      out.write("  \t\t\t\t</tr> \r\n");
      out.write("\t\t\t\t");
 
					 }
			     
      out.write("\r\n");
      out.write("\t\t\t<tr height=\"25\"></tr>\r\n");
      out.write("\t\t\t</table>\r\n");
      out.write("\t\t</td>\r\n");
      out.write("\t</tr>\r\n");
      out.write("\r\n");
      out.write("<!------------------------------------------用户留言区域（收件箱）----------------------------------------------->\r\n");
      out.write("\t\t\t\t\t");

if(true){

      out.write("\r\n");
      out.write("<tr>\r\n");
      out.write("    <td align=\"center\">\r\n");
      out.write("    <table class=\"areatable\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" id=\"table1\">\r\n");
      out.write("\t <tr height=\"10\">\r\n");
      out.write("\t    <td class=\"areatitle\" width=\"25%\" align=\"left\">已收信息</td>\r\n");
      out.write("\t    <td class=\"areatitle\" width=\"15%\" align=\"center\"><a href=\"#\">发件人</a></td>\r\n");
      out.write("\t    <td class=\"areatitle\" width=\"15%\" align=\"center\"><a href=\"#\">日期</a></td>\r\n");
      out.write("<td class=\"areatitle\" width=\"15%\" align=\"center\"><a href=\"#\">状态</a></td>\r\n");
      out.write("\t    <td class=\"areatitle\" width=\"15%\" align=\"center\"><a href=\"#\">管理</a></td>\r\n");
      out.write("\r\n");
      out.write("\t    \r\n");
      out.write("\t  \r\n");
      out.write("\t </tr>\r\n");
      out.write("        <tr>\r\n");
      out.write("\t      <td class=\"separatorline\" colspan=\"5\"></td>\r\n");
      out.write("\t </tr>\r\n");
      out.write("\t <tr height=\"5\">\r\n");
      out.write("\t   <td  colspan=\"5\"></td>\r\n");
      out.write("\t </tr>\r\n");
      out.write("     ");

      String subject;
     String personfrom;
     String sendDate;
     String zhuangtai;
     int id;
     ShortMessage smess=new ShortMessage();
       List list= new ArrayList();
       List cdt=new ArrayList();
       
       
       
       if(userinfo == null){
       		out.print(HtmlTool.msgBox(request, "请先登录","../index.jsp","../index.jsp"));
       		return;
       }else{
       	user = userinfo.getUserCode();
       }
    
     //System.out.println(UserCnNameMap);
       
       //获得收件人编码
       String code=user.getId()+"";
       //System.out.println(code);
     cdt.add("receiveids="+code);
      cdt.add("smsstyle=1") ;
      cdt.add("order by senddate  DESC");
      cdt.add("limit 0,3");
       list=smess.query(cdt);
      // System.out.println(list.size());
       if(list.size()>0){
    	   for(int i=0;i<list.size();i++){
    		   
    		   smess=(ShortMessage)list.get(i);
    		   id=smess.getId();
    		   System.out.println("ID="+id);
    		   subject=smess.getSubject();
    		   System.out.println(smess.getSendId()+"...............................");
    		   personfrom=(String)UserCnNameMap.get(smess.getSendId()+"");
    		   sendDate=Tool.stringOfCnDate(smess.getSendDate());
    		   zhuangtai=smess.getIfSee()==0?"已读":"未读";
    		
      out.write("   \r\n");
      out.write("    \t\t\r\n");
      out.write("    \t\t\t<tr height=\"30\">\r\n");
      out.write("\t       <td width=\"25%\"  class=\"titlecell\" \">&nbsp;&nbsp;<a href=\"javascript:void(0)\" onclick=\"showwinside(");
      out.print(id );
      out.write(',');
      out.write('\'');
      out.print(subject );
      out.write("')\">");
      out.print(subject );
      out.write("</a></td>\r\n");
      out.write("\t\t<td width=\"15%\" class=\"titlecell\" align=\"center\"><a href=\"javascript:void(0)\" onclick=\"showwinside(");
      out.print(id );
      out.write(',');
      out.write('\'');
      out.print(subject );
      out.write("')\">");
      out.print(personfrom);
      out.write("<a></a></td>\r\n");
      out.write("\t       <td width=\"15%\" class=\"titlecell\" align=\"center\"><a href=\"javascript:void(0)\" onclick=\"showwinside(");
      out.print(id );
      out.write(',');
      out.write('\'');
      out.print(subject );
      out.write("')\">");
      out.print(sendDate);
      out.write("<a></a></td>\r\n");
      out.write("\t       <td  width=\"15%\" class=\"titlecell\" align=\"center\"><font color=\"red\">new</font></td>\r\n");
      out.write("\t    <td class=\"titlecell\" align=\"center\"><a href=\"ShortMessageAction.jsp?cmd=delete1&idlist=");
      out.print(id );
      out.write(" \" ><font color=\"red\">删除</font></a></td>\r\n");
      out.write("\t      \r\n");
      out.write("\t \r\n");
      out.write("    \t\t\r\n");
      out.write("    \t\t");
 
    	   }
       }else{
    	  
      out.write("\r\n");
      out.write("    \t <td colspan='3' class='titlecell'>系统当前没有发给您的消息！</td>\r\n");
      out.write(" </tr>\r\n");
      out.write("    \t  ");
 
       }
   
     
      out.write("\r\n");
      out.write("\t  <tr height=\"30\">\r\n");
      out.write("\t       <td class=\"titlecell\" ></td>\r\n");
      out.write("\t\t<td class=\"titlecell\" align=\"center\" ></td>\r\n");
      out.write("\t       <td class=\"titlecell\" align=\"center\" ></td>\r\n");
      out.write("\t       <td class=\"titlecell\" align=\"center\"></td>\r\n");
      out.write("\t       <td class=\"titlecell\" align=\"center\"></td>\r\n");
      out.write("\t  </tr> \r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("     </table>\r\n");
      out.write("     </td>\r\n");
      out.write("</tr>\r\n");
} 
      out.write("\r\n");
      out.write("<!------------------------------------------用户留言区域（发件箱）----------------------------------------------->\r\n");
      out.write("\r\n");
      out.write("\t\t\t\t\t");

if(false){

      out.write("\r\n");
      out.write("<tr>\r\n");
      out.write("    <td align=\"center\">\r\n");
      out.write("    <table class=\"areatable\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" id=\"table2\">\r\n");
      out.write("\t <tr height=\"30\">\r\n");
      out.write("\t    <td class=\"areatitle\" width=\"25%\" align=\"left\">已发信息</td>\r\n");
      out.write("\t    <td class=\"areatitle\" width=\"15%\" align=\"center\"><a href=\"#\">收件人</a></td>\r\n");
      out.write("\t    <td class=\"areatitle\" width=\"15%\" align=\"center\"><a href=\"#\">日期</a></td>\r\n");
      out.write("\t     <td class=\"areatitle\" width=\"15%\" align=\"center\"><a href=\"#\">状态</a></td>\r\n");
      out.write("\t    <td class=\"areatitle\" width=\"15%\" align=\"center\"><a href=\"#\">管理</a></td>\r\n");
      out.write("\r\n");
      out.write("\t    \r\n");
      out.write("\t   \r\n");
      out.write("\t </tr>\r\n");
      out.write("        <tr>\r\n");
      out.write("\t      <td class=\"separatorline\" colspan=\"5\"></td>\r\n");
      out.write("\t </tr>\r\n");
      out.write("\t <tr height=\"5\">\r\n");
      out.write("\t   <td  colspan=\"5\"></td>\r\n");
      out.write("\t </tr>\r\n");
      out.write("       ");

      String subject1;
     String personfrom1;
     String sendDate1;
     String zhuangtai1;
     int id1;
     ShortMessage smess1=new ShortMessage();
       List list1= new ArrayList();
       List cdt1=new ArrayList();
    
       //获得发件人ID
       String name1=user.getCode();
       System.out.println(name1);
       cdt1.add("sendid="+name1);
       cdt1.add("smsstyle=1") ;
       cdt1.add("order by senddate  DESC");
       cdt1.add("limit 0,3");
       list1=smess1.query(cdt1);
       System.out.println(list1.size());
       if(list1.size()>0){
    	   for(int i=0;i<list1.size();i++){
    		   smess1=(ShortMessage)list1.get(i);
    		   id1=smess1.getId();
    		   subject1=smess1.getSubject();
    		   personfrom1=(String)UserCnNameMap.get(smess1.getSendId()+"");
    		   sendDate1=Tool.stringOfCnDate(smess1.getSendDate());
    		   zhuangtai1=smess1.getIfSee()==0?"已读":"未读";
    		
      out.write("   \r\n");
      out.write("    \t\t<tr height=\"30\">\r\n");
      out.write("\t       <td class=\"titlecell\" \">&nbsp;&nbsp;<a href=\"javascript:void(0)\" onclick=\"showwinside(");
      out.print(id1 );
      out.write(',');
      out.write('\'');
      out.print(subject1 );
      out.write("')\">");
      out.print(subject1 );
      out.write("</a></td>\r\n");
      out.write("\t\t<td class=\"titlecell\" align=\"center\"><a href=\"javascript:void(0)\" onclick=\"showwinside(");
      out.print(id1 );
      out.write(',');
      out.write('\'');
      out.print(subject1 );
      out.write("')\">");
      out.print(personfrom1);
      out.write("<a></a></td>\r\n");
      out.write("\t       <td class=\"titlecell\" align=\"center\"><a href=\"javascript:void(0)\" onclick=\"showwinside(");
      out.print(id1 );
      out.write(',');
      out.write('\'');
      out.print(subject1 );
      out.write("')\">");
      out.print(sendDate1);
      out.write("<a></a></td>\r\n");
      out.write("\t       <td  width=\"15%\" class=\"titlecell\" align=\"center\"><font color=\"red\">new</font></td>\r\n");
      out.write("\t       <td class=\"titlecell\" align=\"center\"><a href=\"ShortMessageAction.jsp?cmd=delete1&idlist=");
      out.print(id1 );
      out.write(" \"  \" ><font color=\"red\">删除</font></a></td>\r\n");
      out.write("\t \r\n");
      out.write("    \t\t\r\n");
      out.write("    \t\t");
 
    	   }
       }else{
    	  
      out.write("\r\n");
      out.write("    \t <td colspan='3' class='titlecell'>当前您没有发出任何信息！</td>\r\n");
      out.write(" </tr>\r\n");
      out.write("    \t  ");
 
       }
    	   
     
      out.write("\r\n");
      out.write("     ");
} 
      out.write("\r\n");
      out.write("\r\n");
      out.write("\t");
      out.write("\r\n");
      out.write("\r\n");
      out.write("     </table>\r\n");
      out.write("     </td>\r\n");
      out.write("</tr>\r\n");
      out.write("\r\n");
      out.write("<!------------------------------------------系统公告区域----------------------------------------------->\r\n");
      out.write("\r\n");
      out.write("<!-- <!-- <tr>\r\n");
      out.write("\r\n");
      out.write("    <td align=\"center\">\r\n");
      out.write("    <table class=\"areatable\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\r\n");
      out.write("   \r\n");
      out.write("\t <tr height=\"30\">\r\n");
      out.write("\t    <td class=\"areatitle\" colspan=\"2\" width=\"20%\" align=\"left\">系统公告</td>\r\n");
      out.write("\t   \r\n");
      out.write("\t    <td class=\"areatitle\" width=\"50%\" align=\"center\"></td>\r\n");
      out.write("\t     \r\n");
      out.write("\t    <td class=\"areatitle\" align=\"right\">更多>>&nbsp;</td>\r\n");
      out.write("\t </tr>\r\n");
      out.write("\t\r\n");
      out.write("     <tr>\r\n");
      out.write("\t      <td class=\"separatorline\" colspan=\"5\"></td>\r\n");
      out.write("\t </tr>\r\n");
      out.write("\t  \r\n");
      out.write("\t <tr height=\"5\">\r\n");
      out.write("\t   <td  colspan=\"5\"></td>\r\n");
      out.write("\t </tr>\r\n");
      out.write("\t  \r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("       <tr height=\"15\">\r\n");
      out.write("           <td  colspan=\"5\"></td>\r\n");
      out.write("       </tr>\r\n");
      out.write("\r\n");
      out.write("     </table>\r\n");
      out.write("     </td> -->\r\n");
      out.write("</tr> \r\n");
      out.write("\r\n");
      out.write("<!------------------------------------------团员证补办区域----------------------------------------------->\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("</center>\r\n");
      out.write("</div>\r\n");
      out.write("\r\n");
      out.write("<!----------------------------------------- （1）收件箱图层 ------------------------------------------------------>\r\n");
      out.write("<div id=\"msgdiv1\" style=\"position:absolute;width:400px; height:250px;display:none;\">\r\n");
      out.write("<table width=\"400\" height=\"250\"  border=\"0\" align=\"center\" cellpadding=\"-2\" cellspacing=\"-2\">\r\n");
      out.write("<tr>\r\n");
      out.write("<td align=\"center\">\r\n");
      out.write("<form name=\"form_msg1\" method=\"post\" action=\"#\">\r\n");
      out.write("      <table width=\"100%\" height=\"100%\" bgcolor=\"#cccccc\" border=\"0\" align=\"center\" cellpadding=\"-2\" cellspacing=\"-2\" style=\"border: #9CA6C6 1px solid\" id=\"table_msg1\">\r\n");
      out.write("          <tr height=\"25\" align=\"center\" valign=\"middle\">\r\n");
      out.write("            <td colspan=\"2\" background=\"Images/bg_login.gif\"><font color=\"#505875\">=== 留言 ===</font></td>\r\n");
      out.write("          </tr>\r\n");
      out.write("          \r\n");
      out.write("          <tr height=\"50\" style=\"font-size: 10pt;line-height:150%;\">\r\n");
      out.write("            <td width=\"17%\" align=\"right\" valign=\"middle\">发信人：</td>\r\n");
      out.write("            <td align=\"left\" valign=\"middle\"><input name=\"personfrom\" type=\"text\" size=\"41\"已收消息\r\n");
      out.write("             maxlength=\"50\" disabled></td>\r\n");
      out.write("          </tr>\r\n");
      out.write("          \r\n");
      out.write("          <tr height=\"27\" >\r\n");
      out.write("            <td style=\"font-size: 10pt;line-height:150%;\" align=\"right\" valign=\"middle\">主 &nbsp;题：</td>\r\n");
      out.write("            <td align=\"left\" valign=\"middle\"><input name=\"msgtitle\" type=\"text\" size=\"41\" maxlength=\"50\"></td>\r\n");
      out.write("          </tr>\r\n");
      out.write("          <tr>\r\n");
      out.write("             <td style=\"font-size: 10pt;\" align=\"right\" valign=\"top\"><br>内 &nbsp;容：</td>\r\n");
      out.write("  \t\t\t <td align=\"left\"><textarea rows=\"6\" name=\"msgcontent\" cols=\"40\"></textarea></td>\r\n");
      out.write("\t\t  </tr>\r\n");
      out.write("          <tr align=\"center\" valign=\"top\">\r\n");
      out.write("            <td  colspan=\"2\">\r\n");
      out.write("               <input type=\"button\" name=\"B2\" value=\"回复\" onClick=\"torecallmsg()\">&nbsp;\r\n");
      out.write("               <input type=\"button\" name=\"B2\" value=\"返回\" onClick=\"toupdatemsg()\">&nbsp;\r\n");
      out.write("               <!--\r\n");
      out.write("               <input type=\"button\" name=\"B1\" value=\"删除\" onClick=\"todelmsg()\" onKeyDown=\"if(event.keyCode==13) todelmsg()\">&nbsp;\r\n");
      out.write("               -->\r\n");
      out.write("            </td>\r\n");
      out.write("          </tr>\r\n");
      out.write("      </table>\r\n");
      out.write("\r\n");
      out.write("</form>\r\n");
      out.write("</td>\r\n");
      out.write("</tr>\r\n");
      out.write("</table>\r\n");
      out.write("</div>\r\n");
      out.write("\r\n");
      out.write("<!----------------------------------------- （2）发件箱图层 ------------------------------------------------------>\r\n");
      out.write("<div id=\"msgdiv2\" style=\"position:absolute;width:400px; height:250px;display:none;\">\r\n");
      out.write("<table width=\"400\" height=\"250\"  border=\"0\" align=\"center\" cellpadding=\"-2\" cellspacing=\"-2\">\r\n");
      out.write("<tr>\r\n");
      out.write("<td align=\"center\">\r\n");
      out.write("<form name=\"form_msg2\" method=\"post\" action=\"#\">\r\n");
      out.write("      <table width=\"100%\" height=\"100%\" bgcolor=\"#cccccc\" border=\"0\" align=\"center\" cellpadding=\"-2\" cellspacing=\"-2\" style=\"border: #9CA6C6 1px solid\">\r\n");
      out.write("          <tr height=\"25\" align=\"center\" valign=\"middle\">\r\n");
      out.write("            <td colspan=\"2\" background=\"Images/bg_login.gif\"><font color=\"#505875\">=== 留言 ===</font></td>\r\n");
      out.write("          </tr>\r\n");
      out.write("          \r\n");
      out.write("          <tr height=\"50\" style=\"font-size: 10pt;line-height:150%;\">\r\n");
      out.write("            <td width=\"17%\" align=\"right\" valign=\"middle\">收信人：</td>\r\n");
      out.write("            <td align=\"left\" valign=\"middle\"><input name=\"personto\" type=\"text\" size=\"41\" maxlength=\"50\" disabled></td>\r\n");
      out.write("          </tr>\r\n");
      out.write("          \r\n");
      out.write("          <tr height=\"27\" >\r\n");
      out.write("            <td style=\"font-size: 10pt;line-height:150%;\" align=\"right\" valign=\"middle\">主 &nbsp;题：</td>\r\n");
      out.write("            <td align=\"left\" valign=\"middle\"><input name=\"msgtitle\" type=\"text\" size=\"41\" maxlength=\"50\"></td>\r\n");
      out.write("          </tr>\r\n");
      out.write("          <tr>\r\n");
      out.write("             <td style=\"font-size: 10pt;\" align=\"right\" valign=\"top\"><br>内 &nbsp;容：</td>\r\n");
      out.write("  \t\t\t <td align=\"left\"><textarea rows=\"6\" name=\"msgcontent\" cols=\"40\"></textarea></td>\r\n");
      out.write("\t\t  </tr>\r\n");
      out.write("          <tr align=\"center\" valign=\"top\">\r\n");
      out.write("            <td  colspan=\"2\">\r\n");
      out.write("               <input type=\"button\" name=\"B2\" value=\"返回\" onClick=\"javascript:msgdiv2.style.display='none';\">\r\n");
      out.write("               <input type=\"button\" name=\"B1\" value=\"删除\" onClick=\"todelmsg()\" onKeyDown=\"if(event.keyCode==13) todelmsg()\">&nbsp;\r\n");
      out.write("            </td>\r\n");
      out.write("          </tr>\r\n");
      out.write("      </table>\r\n");
      out.write("\r\n");
      out.write("</form>\r\n");
      out.write("</td>\r\n");
      out.write("</tr>\r\n");
      out.write("</table>\r\n");
      out.write("</div>\r\n");
      out.write("<form name=\"form_save\" action=\"mytips-msgrecallsave.jsp\" method=\"post\" >\r\n");
      out.write("      <input type=\"hidden\" name=\"personfrom\" value=\"()\">\r\n");
      out.write("      <input type=\"hidden\" name=\"personto\" value=\"\">\r\n");
      out.write("      <input type=\"hidden\" name=\"msgtitle\" value=\"\">\r\n");
      out.write("      <input type=\"hidden\" name=\"msgcontent\" value=\"\">\r\n");
      out.write("      <input type=\"hidden\" name=\"id\" value=\"\">\r\n");
      out.write("</form>\r\n");
      out.write("\r\n");
      out.write("<form name=\"form_delete\" action=\"mytips-delete.jsp\" method=\"post\" >\r\n");
      out.write("      <input type=\"hidden\" name=\"id\" value=\"\">\r\n");
      out.write("</form>\r\n");
      out.write("\r\n");
      out.write("<form name=\"form_update\" action=\"mytips-update.jsp\" method=\"post\" >\r\n");
      out.write("      <input type=\"hidden\" name=\"id\" value=\"\">\r\n");
      out.write("      <input type=\"hidden\" name=\"msgtime\" value=\"\">\r\n");
      out.write("      <input type=\"hidden\" name=\"msgstate\" value=\"\">\r\n");
      out.write("</form>\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("</body>\r\n");
      out.write("</html>\r\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
